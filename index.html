<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Företagskalkylator - Löner, Skatt & Utdelning 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        input[type=range] {
            height: 5px;
            -webkit-appearance: none;
            background: #e2e8f0;
            border-radius: 5px;
            outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            box-shadow: 0 0 2px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-12 text-slate-900">

    <div class="max-w-6xl mx-auto px-4 pt-8">
        <header class="mb-10 text-center flex flex-col items-center">
            <h1 class="text-4xl font-extrabold tracking-tight text-slate-900">Företagskalkylator <span class="text-blue-600">2026</span></h1>
            <p class="text-slate-500 mt-2 text-lg">Optimering av lön och utdelning (Uppdaterade 3:12-regler)</p>
            <div class="flex gap-4 mt-4">
                <button onclick="clearAllData()" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest hover:text-red-500 transition-colors">
                    Nollställ Data
                </button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Vänster kolumn: Inmatning & Info -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- Gränsvärden Summary Box -->
                <section class="bg-slate-900 text-white p-6 rounded-2xl shadow-xl">
                    <h2 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Regelverk 2026
                    </h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-end border-b border-slate-700 pb-2">
                            <div>
                                <p class="text-[10px] text-slate-400 font-bold uppercase">Brytpunkt (Statlig skatt)</p>
                                <p class="text-sm font-medium">676 200 kr / år</p>
                            </div>
                            <p class="text-xs text-slate-500">56 350 kr/mån</p>
                        </div>

                        <div class="flex justify-between items-end border-b border-slate-700 pb-2">
                            <div>
                                <p class="text-[10px] text-slate-400 font-bold uppercase">IBB 2026</p>
                                <p class="text-sm font-medium">80 600 kr</p>
                            </div>
                            <p class="text-xs text-slate-500">Inkomstbasbelopp</p>
                        </div>
                        
                        <div class="pt-2">
                            <p class="text-[10px] text-slate-400 font-bold uppercase mb-2">Utdelningsregel</p>
                            <div class="flex p-1 bg-slate-800 rounded-lg">
                                <button id="ruleSimplified" onclick="setDividendRule('simplified')" class="flex-1 py-1.5 text-[10px] font-bold rounded-md bg-slate-700 text-white transition-all">FÖRENKLING</button>
                                <button id="ruleWage" onclick="setDividendRule('wage')" class="flex-1 py-1.5 text-[10px] font-bold rounded-md text-slate-400 transition-all">LÖNEBASERAD</button>
                            </div>
                            <p id="ruleHint" class="text-[10px] text-slate-500 mt-2 italic leading-tight">
                                Förenklingsregeln: 4.0 x IBB (2026) = 322 400 kr.
                            </p>
                        </div>

                        <div id="salaryRequirementBox" class="hidden mt-4 p-3 bg-blue-900/50 rounded-lg border border-blue-700">
                             <p class="text-[10px] text-blue-300 font-bold uppercase">Lönekrav för huvudregeln</p>
                             <p class="text-lg font-bold text-white" id="reqAmount">-- kr</p>
                             <p class="text-[10px] text-blue-300 italic mt-1" id="reqStatus">Lägg till lön för att beräkna...</p>
                        </div>
                    </div>
                </section>

                <!-- Lägg till Person -->
                <section class="glass-card p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h2 class="text-lg font-semibold mb-4 flex items-center">
                        <span class="bg-blue-100 text-blue-600 p-1.5 rounded-lg mr-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path></svg>
                        </span>
                        Lägg till personal
                    </h2>
                    
                    <div class="flex p-1 bg-slate-100 rounded-lg mb-4">
                        <button id="typeConsultant" onclick="setEntryType('consultant')" class="flex-1 py-1.5 text-xs font-bold rounded-md bg-white shadow-sm transition-all">KONSULT</button>
                        <button id="typeAdmin" onclick="setEntryType('admin')" class="flex-1 py-1.5 text-xs font-bold rounded-md text-slate-500 transition-all">ADMIN/STAFF</button>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Namn</label>
                            <input type="text" id="name" placeholder="Namn" class="w-full p-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        
                        <div id="consultantFields" class="space-y-4">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Debiterat/tim</label>
                                    <input type="number" id="hourlyRate" value="1200" class="w-full p-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Tim/v</label>
                                    <input type="number" id="hours" value="40" class="w-full p-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Arbetsveckor/år</label>
                                <input type="number" id="weeks" value="45" class="w-full p-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Önskad Bruttolön/mån (kr)</label>
                            <input type="number" id="monthlySalary" value="56000" class="w-full p-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-bold text-blue-600">
                        </div>

                        <button onclick="addEmployee()" class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition-colors shadow-lg shadow-blue-100">
                            Lägg till i kalkyl
                        </button>
                    </div>
                </section>

                <section class="glass-card p-6 rounded-2xl shadow-sm border border-slate-200">
                    <h2 class="text-lg font-semibold mb-4 text-red-600 uppercase tracking-tighter">Fasta utgifter (Månad)</h2>
                    <div class="space-y-4">
                        <div class="flex gap-2">
                            <input type="text" id="costLabel" placeholder="t.ex. Hyra" class="flex-1 p-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-red-500 outline-none text-sm">
                            <input type="number" id="costAmount" placeholder="kr" class="w-24 p-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-red-500 outline-none text-sm">
                        </div>
                        <button onclick="addCost()" class="w-full py-2 border border-red-200 text-red-600 hover:bg-red-50 font-bold rounded-lg transition-colors text-xs uppercase">
                            + Lägg till utgift
                        </button>
                        <div id="costsList" class="space-y-2 mt-2 max-h-40 overflow-y-auto"></div>
                    </div>
                </section>
            </div>

            <!-- Höger kolumn: Resultat -->
            <div class="lg:col-span-8 space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Omsättning (År)</p>
                        <p class="text-xl font-black text-slate-800" id="totalGross">0 kr</p>
                    </div>
                    <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Bolagsskatt (20.6%)</p>
                        <p class="text-xl font-black text-orange-500" id="totalCorpTax">0 kr</p>
                    </div>
                    <div class="bg-emerald-600 p-5 rounded-2xl shadow-lg shadow-emerald-100" id="profitCard">
                        <p class="text-[10px] font-bold text-emerald-100 uppercase tracking-wider mb-1">Vinst efter skatt</p>
                        <p class="text-xl font-black text-white" id="totalProfit">0 kr</p>
                    </div>
                    <div class="bg-blue-900 p-5 rounded-2xl shadow-lg shadow-blue-100 relative group">
                        <p class="text-[10px] font-bold text-blue-300 uppercase tracking-wider mb-1">Utdelningsrum (20%)</p>
                        <p class="text-xl font-black text-white" id="totalDividend">0 kr</p>
                        <span id="dividendStatusIcon" class="absolute top-2 right-2 text-xs"></span>
                    </div>
                </div>

                <div class="space-y-4">
                    <div id="employeeGrid" class="space-y-4"></div>
                </div>
                
                <div id="emptyState" class="text-center py-20 bg-white rounded-2xl border-2 border-dashed border-slate-200">
                    <p class="text-slate-400 font-medium">Lägg till personal för att simulera 2026 års resultat.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let employees = [];
        let companyCosts = [];
        let currentEntryType = 'consultant';
        let currentDividendRule = 'simplified'; 
        
        // --- 2026 UPDATED CONSTANTS ---
        const ARBETSGIVARAVGIFT = 0.3142; 
        const SKIKTGRANS_2026 = 676200; 
        const BOLAGSSKATT_RATE = 0.206;
        const SARSKILD_LONESKATT_PENSION = 0.2426;
        
        // --- NEW 2026 RULES (3:12 Reform) ---
        const INCOME_BASE_AMOUNT_2026 = 80600; 
        const SIMPLIFIED_RULE_MULTIPLIER = 4.0; // Increased from 2.75
        const SCHABLON_UTDELNING_2026 = INCOME_BASE_AMOUNT_2026 * SIMPLIFIED_RULE_MULTIPLIER; // 80,600 * 4 = 322,400 kr
        
        const WAGE_RULE_IBB_FACTOR = 6; 
        const WAGE_RULE_MAX_THRESHOLD = 9.6 * INCOME_BASE_AMOUNT_2026; 

        const STORAGE_KEY_EMPLOYEES = 'payroll_tool_employees_v5';
        const STORAGE_KEY_COSTS = 'payroll_tool_costs_v5';

        window.onload = function() {
            const savedEmployees = localStorage.getItem(STORAGE_KEY_EMPLOYEES);
            const savedCosts = localStorage.getItem(STORAGE_KEY_COSTS);
            if (savedEmployees) employees = JSON.parse(savedEmployees);
            if (savedCosts) companyCosts = JSON.parse(savedCosts);
            updateCalculations();
        };

        function saveData() {
            localStorage.setItem(STORAGE_KEY_EMPLOYEES, JSON.stringify(employees));
            localStorage.setItem(STORAGE_KEY_COSTS, JSON.stringify(companyCosts));
        }

        function clearAllData() {
            if (confirm("Nollställ all data?")) {
                employees = [];
                companyCosts = [];
                saveData();
                updateCalculations();
            }
        }

        function setEntryType(type) {
            currentEntryType = type;
            const cBtn = document.getElementById('typeConsultant');
            const aBtn = document.getElementById('typeAdmin');
            const cFields = document.getElementById('consultantFields');
            if (type === 'consultant') {
                cBtn.className = "flex-1 py-1.5 text-xs font-bold rounded-md bg-white shadow-sm transition-all";
                aBtn.className = "flex-1 py-1.5 text-xs font-bold rounded-md text-slate-500 transition-all";
                cFields.classList.remove('hidden');
            } else {
                aBtn.className = "flex-1 py-1.5 text-xs font-bold rounded-md bg-white shadow-sm transition-all";
                cBtn.className = "flex-1 py-1.5 text-xs font-bold rounded-md text-slate-500 transition-all";
                cFields.classList.add('hidden');
            }
        }

        function setDividendRule(rule) {
            currentDividendRule = rule;
            const sBtn = document.getElementById('ruleSimplified');
            const wBtn = document.getElementById('ruleWage');
            const hint = document.getElementById('ruleHint');
            const salBox = document.getElementById('salaryRequirementBox');
            
            if (rule === 'simplified') {
                sBtn.className = "flex-1 py-1.5 text-[10px] font-bold rounded-md bg-slate-700 text-white transition-all";
                wBtn.className = "flex-1 py-1.5 text-[10px] font-bold text-slate-400 transition-all";
                hint.innerText = `Förenklingsregeln: 4.0 x IBB (2026) = ${SCHABLON_UTDELNING_2026.toLocaleString('sv-SE')} kr.`;
                salBox.classList.add('hidden');
            } else {
                wBtn.className = "flex-1 py-1.5 text-[10px] font-bold rounded-md bg-slate-700 text-white transition-all";
                sBtn.className = "flex-1 py-1.5 text-[10px] font-bold text-slate-400 transition-all";
                hint.innerText = "Lönebaserad: 50% av totala löner. Kräver att du tar ut tillräcklig lön.";
                salBox.classList.remove('hidden');
            }
            updateCalculations();
        }

        function addEmployee() {
            const name = document.getElementById('name').value || (currentEntryType === 'consultant' ? "Person" : "Admin");
            const monthlySalary = parseFloat(document.getElementById('monthlySalary').value);
            if (isNaN(monthlySalary)) return;

            employees.push({
                id: Date.now(),
                name,
                type: currentEntryType,
                monthlySalary,
                hourlyRate: currentEntryType === 'consultant' ? parseFloat(document.getElementById('hourlyRate').value) : 0,
                hours: currentEntryType === 'consultant' ? parseFloat(document.getElementById('hours').value) : 40,
                weeks: currentEntryType === 'consultant' ? parseFloat(document.getElementById('weeks').value) : 52,
                taxRate: 32, 
                pensionRate: 4.5 
            });
            document.getElementById('name').value = '';
            saveData();
            updateCalculations();
        }

        function removeEmployee(id) {
            employees = employees.filter(e => e.id !== id);
            saveData();
            updateCalculations();
        }

        function updateEmployeeData(id, field, val) {
            const emp = employees.find(e => e.id == id);
            if (emp) {
                emp[field] = parseFloat(val) || 0;
                saveData();
                updateCalculations();
            }
        }

        function addCost() {
            const label = document.getElementById('costLabel').value || "Utgift";
            const amount = parseFloat(document.getElementById('costAmount').value);
            if (isNaN(amount)) return;
            companyCosts.push({ id: Date.now(), label, amount });
            document.getElementById('costLabel').value = '';
            document.getElementById('costAmount').value = '';
            saveData();
            updateCalculations();
        }

        function removeCost(id) {
            companyCosts = companyCosts.filter(c => c.id !== id);
            saveData();
            updateCalculations();
        }

        function calculateNetSalary(annualBrutto, municipalTaxRate) {
            const grundavdrag = 25000; 
            const taxable = Math.max(0, annualBrutto - grundavdrag);
            let tax = taxable * municipalTaxRate;
            if (annualBrutto > SKIKTGRANS_2026) {
                tax += (annualBrutto - SKIKTGRANS_2026) * 0.20;
            }
            return annualBrutto - tax;
        }

        function updateCalculations() {
            const annualFixedCosts = companyCosts.reduce((acc, c) => acc + c.amount, 0) * 12;

            const costsList = document.getElementById('costsList');
            costsList.innerHTML = companyCosts.map(c => `
                <div class="flex justify-between items-center bg-white p-2 px-3 rounded-lg border border-slate-200 text-xs">
                    <span class="text-slate-600 font-medium">${c.label}</span>
                    <div class="flex items-center gap-2">
                        <span class="font-bold text-slate-800">${c.amount.toLocaleString('sv-SE')} kr</span>
                        <button onclick="removeCost(${c.id})" class="text-slate-300 hover:text-red-500">×</button>
                    </div>
                </div>
            `).join('');

            const container = document.getElementById('employeeGrid');
            const emptyState = document.getElementById('emptyState');
            
            if (employees.length === 0) {
                emptyState.style.display = 'block';
                container.innerHTML = '';
                updateSummary(0, annualFixedCosts, 0, 0, 0);
                return;
            }
            emptyState.style.display = 'none';

            let totalCompanyRevenue = 0;
            let totalPersonnelCostsToCompany = 0;
            let totalBruttoSalaries = 0;
            let highestSalary = 0;

            container.innerHTML = employees.map(emp => {
                const annualGrossRevenue = emp.type === 'consultant' ? (emp.hourlyRate * emp.hours * emp.weeks) : 0;
                totalCompanyRevenue += annualGrossRevenue;
                
                const bruttolonAnnual = emp.monthlySalary * 12;
                totalBruttoSalaries += bruttolonAnnual;
                if (bruttolonAnnual > highestSalary) highestSalary = bruttolonAnnual;

                const monthlyPensionPremium = emp.monthlySalary * (emp.pensionRate / 100);
                const annualPensionPremium = monthlyPensionPremium * 12;
                const totalPensionCostAnnual = annualPensionPremium * (1 + SARSKILD_LONESKATT_PENSION);
                
                const totalCostToCompany = (bruttolonAnnual * (1 + ARBETSGIVARAVGIFT)) + totalPensionCostAnnual;
                const nettolonAnnual = calculateNetSalary(bruttolonAnnual, emp.taxRate / 100);
                
                totalPersonnelCostsToCompany += totalCostToCompany;
                const isOverLimit = bruttolonAnnual > SKIKTGRANS_2026;

                return `
                    <div class="glass-card p-6 rounded-2xl shadow-sm border border-slate-200">
                        <div class="flex justify-between items-start mb-6">
                            <div class="flex items-center gap-2">
                                <span class="px-2 py-0.5 rounded text-[10px] font-bold uppercase ${emp.type === 'consultant' ? 'bg-blue-100 text-blue-600' : 'bg-purple-100 text-purple-600'}">
                                    ${emp.type === 'consultant' ? 'Konsult' : 'Staff'}
                                </span>
                                <h3 class="font-bold text-slate-900 text-lg">${emp.name}</h3>
                            </div>
                            <button onclick="removeEmployee(${emp.id})" class="text-slate-300 hover:text-red-500 text-xs font-bold uppercase">Radera</button>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            <div class="lg:col-span-4 space-y-4">
                                ${emp.type === 'consultant' ? `
                                    <div>
                                        <div class="flex justify-between text-[10px] font-bold text-slate-400 uppercase mb-1">
                                            <span>Timpris</span>
                                            <span class="text-blue-600">${emp.hourlyRate} kr</span>
                                        </div>
                                        <input type="range" min="300" max="3000" step="25" value="${emp.hourlyRate}" 
                                               oninput="updateEmployeeData(${emp.id}, 'hourlyRate', this.value)" class="w-full">
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <p class="text-[10px] text-slate-400 font-bold uppercase">Tim/v</p>
                                            <input type="number" value="${emp.hours}" onchange="updateEmployeeData(${emp.id}, 'hours', this.value)" class="w-full text-xs p-1.5 border rounded-lg bg-slate-50">
                                        </div>
                                        <div>
                                            <p class="text-[10px] text-slate-400 font-bold uppercase">Veckor/år</p>
                                            <input type="number" value="${emp.weeks}" onchange="updateEmployeeData(${emp.id}, 'weeks', this.value)" class="w-full text-xs p-1.5 border rounded-lg bg-slate-50">
                                        </div>
                                    </div>
                                ` : `<div class="p-8 text-center text-slate-300 text-xs italic">Ingen direkt intäkt</div>`}
                            </div>

                            <div class="lg:col-span-4 space-y-4 border-l border-slate-100 pl-8">
                                <div>
                                    <label class="text-[10px] font-bold text-slate-400 uppercase block mb-1">Bruttolön /mån</label>
                                    <input type="number" value="${emp.monthlySalary}" 
                                           onchange="updateEmployeeData(${emp.id}, 'monthlySalary', this.value)"
                                           class="w-full p-2.5 bg-slate-50 border rounded-lg text-sm font-bold text-blue-600">
                                </div>
                                <div>
                                    <div class="flex justify-between text-[10px] font-bold text-slate-400 uppercase mb-1">
                                        <span>Skattetabell</span>
                                        <span class="text-blue-600">${emp.taxRate}</span>
                                    </div>
                                    <input type="range" min="25" max="35" step="0.5" value="${emp.taxRate}" 
                                           oninput="updateEmployeeData(${emp.id}, 'taxRate', this.value)" class="w-full">
                                </div>
                                <div>
                                    <div class="flex justify-between text-[10px] font-bold text-slate-400 uppercase mb-1">
                                        <span>Tjänstepension %</span>
                                        <span class="text-blue-600">${emp.pensionRate}%</span>
                                    </div>
                                    <input type="range" min="0" max="35" step="0.5" value="${emp.pensionRate}" 
                                           oninput="updateEmployeeData(${emp.id}, 'pensionRate', this.value)" class="w-full">
                                </div>
                            </div>

                            <div class="lg:col-span-4">
                                <div class="bg-blue-600 p-5 rounded-2xl text-white h-full flex flex-col justify-center">
                                    <p class="text-[10px] uppercase font-bold text-blue-200 tracking-wider mb-1">Netto i handen /mån</p>
                                    <p class="text-3xl font-black">${Math.round(nettolonAnnual/12).toLocaleString('sv-SE')} kr</p>
                                    <div class="mt-3 pt-3 border-t border-blue-500 text-[10px] space-y-1">
                                        <div class="flex justify-between">
                                            <span>Pension inkl löneskatt:</span>
                                            <span>${Math.round(totalPensionCostAnnual/12).toLocaleString('sv-SE')} kr</span>
                                        </div>
                                        <div class="flex justify-between font-bold">
                                            <span>Total bolagskostnad:</span>
                                            <span>${Math.round(totalCostToCompany/12).toLocaleString('sv-SE')} kr</span>
                                        </div>
                                        ${isOverLimit ? '<span class="inline-block mt-2 bg-white text-blue-600 px-1.5 font-black rounded">STATLIG SKATT</span>' : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            const profitBeforeTax = totalCompanyRevenue - totalPersonnelCostsToCompany - annualFixedCosts;
            updateSummary(totalCompanyRevenue, totalPersonnelCostsToCompany + annualFixedCosts, profitBeforeTax, totalBruttoSalaries, highestSalary);
        }

        function updateSummary(gross, costs, profitBeforeTax, totalBrutto, highestSalary) {
            const corpTax = profitBeforeTax > 0 ? profitBeforeTax * BOLAGSSKATT_RATE : 0;
            const netProfit = profitBeforeTax - corpTax;
            
            // Calculate Salary Requirement for Wage-Based Rule (Using 2026 IBB)
            const requirementA = (WAGE_RULE_IBB_FACTOR * INCOME_BASE_AMOUNT_2026) + (totalBrutto * 0.05);
            const salaryThreshold = Math.min(requirementA, WAGE_RULE_MAX_THRESHOLD);
            
            let potentialDividend = 0;
            let statusIcon = "";
            
            if (currentDividendRule === 'simplified') {
                potentialDividend = SCHABLON_UTDELNING_2026;
                statusIcon = "✅";
            } else {
                potentialDividend = totalBrutto * 0.5;
                const reqAmtElem = document.getElementById('reqAmount');
                const reqStatElem = document.getElementById('reqStatus');
                
                reqAmtElem.innerText = Math.round(salaryThreshold).toLocaleString('sv-SE') + " kr";
                
                if (highestSalary >= salaryThreshold) {
                    statusIcon = "✅";
                    reqStatElem.innerText = "Kravet är uppfyllt!";
                    reqStatElem.className = "text-[10px] text-emerald-400 italic mt-1";
                } else {
                    statusIcon = "⚠️";
                    reqStatElem.innerText = "Kravet ej uppfyllt. Öka lönen.";
                    reqStatElem.className = "text-[10px] text-orange-400 italic mt-1";
                }
            }

            const actualDividendLimit = Math.min(netProfit > 0 ? netProfit : 0, potentialDividend);

            document.getElementById('totalGross').innerText = Math.round(gross).toLocaleString('sv-SE') + ' kr';
            document.getElementById('totalCorpTax').innerText = Math.round(corpTax).toLocaleString('sv-SE') + ' kr';
            document.getElementById('totalProfit').innerText = Math.round(netProfit).toLocaleString('sv-SE') + ' kr';
            document.getElementById('totalDividend').innerText = Math.round(actualDividendLimit).toLocaleString('sv-SE') + ' kr';
            document.getElementById('dividendStatusIcon').innerText = statusIcon;
            
            const profitCard = document.getElementById('profitCard');
            profitCard.className = netProfit < 0 ? 'bg-red-600 p-5 rounded-2xl shadow-lg shadow-red-100' : 'bg-emerald-600 p-5 rounded-2xl shadow-lg shadow-emerald-100';
        }
    </script>
</body>
</html>
